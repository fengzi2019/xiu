console.log("Last modification time: 2019-5-3 13:54:52"),function(e){function t(t){for(var i,r,c=t[0],d=t[1],s=t[2],u=0,f=[];u<c.length;u++)r=c[u],o[r]&&f.push(o[r][0]),o[r]=0;for(i in d)Object.prototype.hasOwnProperty.call(d,i)&&(e[i]=d[i]);for(l&&l(t);f.length;)f.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,c=1;c<n.length;c++){var d=n[c];0!==o[d]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},o={3:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./";var c=window.webpackJsonp=window.webpackJsonp||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var l=d;a.push([33,0]),n()}([,function(e,t,n){"use strict";var i=n(0),o=n.n(i),a=function(){var e=function(e,t){e instanceof Array?e.map(function(e){return t(e)}):t(e)};return{hide:function(t){e(t,function(e){o()(e).hide()})},show:function(t){e(t,function(e){o()(e).show()})},toggle:function(t){e(t,function(e){o()(e).toggle()})},enable:function(t){e(t,function(e){o()(e).removeClass("disabled")})},disable:function(t){e(t,function(e){o()(e).addClass("disabled")})}}}();t.a=a},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a});var i={"120p,120p_1":[160,120,15,65],"240p_1":[320,240,15,200],"360p_4":[640,360,30,600],"480p_4":[640,480,30,750],"720p_3":[1280,720,30,1710],"1080p_5":[1920,1080,60,4780]},o=1,a="93d12c81e657400f8946294d00f18854"},,function(e,t,n){"use strict";n(19);t.a={init:function(e,t,n){this.MAX_RATIO=n,this.MIN_RATIO=t,this.canvas=document.querySelector("#"+e)},_checkRatio:function(e,t){var n=t/e;return!(n>this.MAX_RATIO||n<this.MIN_RATIO)},customRender:function(e,t,n){this.canvas.classList.remove("container__flex"),this.canvas.classList.add("container__grid");var i=e.length;n=n||e[e.length-1]&&e[e.length-1].getId(),i>4&&1===t||i>8?(t=0,console.log("Automatically switch to tile mode..."),this.rendererFactory(e,t,n)):this.rendererFactory(e,t,n)},rendererFactory:function(e,t,n){if(0===t)this.tileRenderer(e);else if(1===t)this.pipRenderer(e,n);else{if(2!==t)throw Error("Wrong mode for renderer");this.sharingRenderer(e,n)}},updateVideoItem:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.getId(),o=document.querySelector("#video-item-"+i);if(!o){o=document.createElement("section");var a=document.createElement("div");o.setAttribute("id","video-item-"+i),o.setAttribute("class","video-item"),a.setAttribute("class","video-item-box"),o.appendChild(a),this.canvas.appendChild(o),e.play("video-item-"+i)}n?o.classList.add("window__fit"):o.classList.remove("window__fit"),o.setAttribute("style",t)},enterFullScreen:function(){this.canvas.classList.add("fullscreen")},exitFullScreen:function(){this.canvas.classList.remove("fullscreen")},tileRenderer:function(e){var t=function(e){for(var t=e.width,n=e.height,i=e.minRatio,o=e.maxRatio,a=e.count,r=void 0,c=void 0,d=void 0,s=void 0,l=void 0,u=1;u<=a;u++){var f=u,h=Math.ceil(a/u);c=Math.floor((t-5)/h);var v=(d=Math.floor((n-5)/f))/c;v>o?d=(v=o)*c:v<i&&(c=d/(v=i));var m=c*d*a;(void 0===r||m>r)&&(r=m,l=d,s=c)}return{height:l,width:s}}({width:this.canvas.clientWidth,height:this.canvas.clientHeight,minRatio:this.MIN_RATIO,maxRatio:this.MAX_RATIO,count:e.length}),n=t.width,i=t.height;this.canvas.classList.remove("container__grid"),this.canvas.classList.add("container__flex");var o=!0,a=!1,r=void 0;try{for(var c,d=e[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var s=c.value;this.updateVideoItem(s,"width: "+n+"px; height: "+i+"px;")}}catch(e){a=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(a)throw r}}},pipRenderer:function(e,t){var n=e.length;if(n>4)throw Error("PIP mode only suitable for less than 4 stream");if(!this._checkRatio(4*this.canvas.clientWidth/24,3*this.canvas.clientHeight/12)||!this._checkRatio(12*this.canvas.clientWidth/24,12*this.canvas.clientHeight/12))return this.tileRenderer(e);for(var i=0,o=0;i<n;i++){var a=e[i];a.getId()===t?this.updateVideoItem(a,"grid-area: span 12/span 24/13/25"):(this.updateVideoItem(a,"grid-area: span 3/span 4/"+(4+3*o)+"/25;\n                    z-index:1;width:calc(100% - 20px);height:calc(100% - 20px)"),o++)}},sharingRenderer:function(e,t){var n=e.length;if(n>8)throw Error("Screen Sharing Mode only suitable for less than 8 stream");if(!this._checkRatio(4*this.canvas.clientWidth/24,4*this.canvas.clientHeight/12)&&1!==e.length){var i=e.findIndex(function(e){return e.getId()===t});if(-1===i)throw Error("Cannot find stream by given mainId!");for(var o=0;o<n;o++)o!==i&&this.updateVideoItem(e[o],"display: none");return this.sharingRenderer([e[i]],t)}var a=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e));if(8===n){var r=a.findIndex(function(e){return e.hasAudio()&&!e.hasVideo()});-1===r&&(r=7);var c=a[r];this.updateVideoItem(c,"display: none"),a.splice(r,1)}var d=!0,s=!1,l=void 0;try{for(var u,f=a[Symbol.iterator]();!(d=(u=f.next()).done);d=!0){var h=u.value;h.getId()===t?1===n?this.updateVideoItem(h,"grid-area: span 12/span 24/13/25;",!0):n<5?this.updateVideoItem(h,"grid-area: span 12/span 20/13/25;",!0):this.updateVideoItem(h,"grid-area: span 12/span 16/13/21;",!0):this.updateVideoItem(h,"grid-area: span 4/span 4")}}catch(e){s=!0,l=e}finally{try{!d&&f.return&&f.return()}finally{if(s)throw l}}}}},function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var i=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},o=function(){return window.innerWidth<=800&&window.innerHeight<=830},a=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},r=function(){return"undefined"!=typeof InstallTrigger}},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i});var i=function(e,t,n){console.log("%c "+e+": "+n,"color: "+t)},o={init:function(e,t){return function(n){return i(e,t,n)}}}},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){"use strict";var i=n(0),o=n.n(i),a=function(){var e=o()(".notification-container");e.length||(o()("body").append('<div class="notification-container" \n                    style="z-index: 12;position: absolute;\n                    width: 38.2%;max-width: 450px; \n                    min-width: 300px;left: 0;\n                    bottom: 0;"></div>'),e=o()(".notification-container"));var t=function(t,n,i){var a=(new Date).getTime(),r='<div id="notify-'+a+'" class="notification is-'+t+'">\n                                <button class="delete"></button>\n                                '+n+"\n                            </div>";e.append(r),o()("#notify-"+a+" .delete").on("click",function(){o()("#notify-"+a).remove()}),setTimeout(function(){o()("#notify-"+a).remove()},i)};return{primary:function(e,n){t("primary",e,n)},link:function(e,n){t("link",e,n)},info:function(e,n){t("info",e,n)},success:function(e,n){t("success",e,n)},warning:function(e,n){t("warning",e,n)},danger:function(e,n){t("danger",e,n)}}}();t.a=a},,function(e,t,n){"use strict";Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),n=t.length,i=new Array(n);n--;)i[n]=[t[n],e[t[n]]];return i})},,,,,function(e,t,n){},,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),function(e){n(15);var t=n(0),i=n.n(t),o=n(3),a=n(13),r=(n(8),n(10),n(34),n(1)),c=n(5),d=n(12),s=n(4),l=n(2),u=n(6),f=(n(14),{}),h={},v={},m=[],p=null,g=null,b=void 0,y=void 0,w=u.b.init("global","blue"),I=u.b.init("share","yellow"),M=u.b.init("local","green"),S=function(e,t){return new Promise(function(n,i){e.init(t.key,function(){w("AgoraRTC client initialized");var o=l.b[t.videoProfileLow];e.join(t.key,t.channel,t.uid,function(t){Object(u.a)(t,"brown","User "+t+" join channel successfully"),Object(u.a)(t,"brown",(new Date).toLocaleTimeString()),e.setLowStreamParameter({width:o[0],height:o[1],framerate:o[2],bitrate:o[3]}),n(t)},function(e){i(e)})})})},R=function(e,t,n){var i={streamID:e,audio:!0,video:!0,screen:!1};switch(t.attendeeMode){case"audio-only":i.video=!1;break;case"audience":i.video=!1,i.audio=!1;break;default:case"video":}var o=AgoraRTC.createStream(Object(a.a)(i,n));return o.setVideoProfile(t.videoProfile),o},_=function(){try{p&&p.unpublish(g),g&&g.close(),p&&p.leave(function(){I("Share client succeed to leave.")},function(){I("Share client failed to leave.")})}finally{p=null,g=null}};window.installSuccess=function(){w.apply(void 0,arguments)},window.installError=function(){w.apply(void 0,arguments),d.a.danger("Failed to install the extension, please check the network and console.",3e3)};var k=function(e){m.map(function(t,n){return t.getId()===e?(m[n].close(),i()("#video-item-"+e).remove(),m.splice(n,1),1):0}),m.length<=4&&2!==f.displayMode&&r.a.enable(".displayModeBtn"),s.a.customRender(m,f.displayMode,b)},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getId();m.some(function(e){return e.getId()===n})||(t?m.push(e):m.unshift(e),m.length>4&&(f.displayMode=1===f.displayMode?0:f.displayMode,r.a.disable([".displayModeBtn",".disableRemoteBtn"])),s.a.customRender(m,f.displayMode,b))},A=function(e){return m.filter(function(t){return t.getId()===e})[0]},B=function(e,t){if(e!==t){var n=void 0,i=void 0,o=!0,a=!1,r=void 0;try{for(var c,d=m[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var s=c.value,l=s.getId();l===e?n=s:l===t&&(i=s)}}catch(e){a=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(a)throw r}}n&&h.setRemoteVideoStreamType(n,1),i&&h.setRemoteVideoStreamType(i,0)}};(function(e){switch(s.a.init("ag-canvas",9/16,1.6),Object(c.c)()&&s.a.enterFullScreen(),Object(c.b)()||Object(c.a)()||r.a.disable(".shareScreenBtn"),i()("#room-name").html(e.channel),e.attendeeMode){case"audio-only":r.a.hide([".videoControlBtn",".shareScreenBtn"]);break;case"audience":r.a.hide([".videoControlBtn",".audioControlBtn",".shareScreenBtn"]);break;default:case"video":}})(f=function(){var e={videoProfile:o.get("videoProfile").split(",")[0]||"480p_4",videoProfileLow:o.get("videoProfileLow"),cameraId:o.get("cameraId"),microphoneId:o.get("microphoneId"),channel:o.get("channel")||"test",transcode:o.get("transcode")||"h264",attendeeMode:o.get("attendeeMode")||"video",baseMode:o.get("baseMode")||"avc",displayMode:1,uid:void 0,resolution:void 0},t=l.b[o.get("videoProfile")];return e.resolution=t[0]/t[1]||4/3,e.key=l.a,e}()),h=AgoraRTC.createClient({codec:f.transcode,mode:"live"}),i()(".displayModeBtn").on("click",function(e){e.currentTarget.classList.contains("disabled")||m.length<=1||(1===f.displayMode?(f.displayMode=0,r.a.disable(".disableRemoteBtn")):0===f.displayMode&&(f.displayMode=1,r.a.enable(".disableRemoteBtn")),s.a.customRender(m,f.displayMode,b))}),i()(".exitBtn").on("click",function(){try{p&&_(),h&&h.unpublish(v),v&&v.close(),h&&h.leave(function(){M("Client succeed to leave.")},function(){M("Client failed to leave.")})}finally{window.location.href="index.html"}}),i()(".videoControlBtn").on("click",function(){i()(".videoControlBtn").toggleClass("off"),v.isVideoOn()?v.disableVideo():v.enableVideo()}),i()(".audioControlBtn").on("click",function(){i()(".audioControlBtn").toggleClass("off"),v.isAudioOn()?v.disableAudio():v.enableAudio()}),i()(".shareScreenBtn").on("click",function(e){e.currentTarget.classList.contains("disabled")||(p?_():function(){r.a.disable(".shareScreenBtn"),p=AgoraRTC.createClient({codec:f.transcode,mode:"live"});var e=Object(a.a)(f,{uid:l.c});S(p,e).then(function(t){(g=R(t,e,{screen:!0,video:!1,audio:!1,extensionId:"minllpmhdgpndnkomcoccfekfegnlikg",mediaSource:"screen"})).init(function(){r.a.enable(".shareScreenBtn"),g.on("stopScreenSharing",function(){_(),I("Stop Screen Sharing at"+new Date)}),p.publish(g,function(e){I("Publish share stream error: "+e),I("getUserMedia failed",e)})},function(e){r.a.enable(".shareScreenBtn"),I("getUserMedia failed",e),_(),Object(c.a)()&&d.a.danger('Please install chrome extension before using sharing screen. \n            <hr />\n            <a id="addExtensionBtn" class="button is-link" onclick="chrome.webstore.install(\'https://chrome.google.com/webstore/detail/minllpmhdgpndnkomcoccfekfegnlikg\', installSuccess, installError)">Add chrome extension</a>\n          ',5e3)})})}())}),i()(".disableRemoteBtn").on("click",function(e){if(!(e.currentTarget.classList.contains("disabled")||m.length<=1)){i()(".disableRemoteBtn").toggleClass("off");var t=v.getId();Array.from(document.querySelectorAll(".video-item:not(#video-item-"+t+")")).map(function(e){return"none"===e.style.display?(e.style.display="block",1):(e.style.display="none",0)})}}),i()(window).resize(function(e){Object(c.c)()?s.a.enterFullScreen():s.a.exitFullScreen(),s.a.customRender(m,f.displayMode,b)}),i()(".ag-container").dblclick(function(e){for(var t=e.target;!t.classList.contains("video-item");)if((t=t.parentNode).classList.contains("ag-main"))return;var n=parseInt(t.id.split("-")[2],10);if(n!==b&&n!==v.getId()){var i=2===f.displayMode?l.c:n;B(b,i),y=A(b=i)}s.a.customRender(m,f.displayMode,b)}),i()(document).mousemove(function(t){e._toolbarToggle&&clearTimeout(e._toolbarToggle),i()(".ag-btn-group").addClass("active"),e._toolbarToggle=setTimeout(function(){i()(".ag-btn-group").removeClass("active")},2500)}),h.on("stream-added",function(e){var t=e.stream,n=t.getId();M("New stream added: "+n),M((new Date).toLocaleTimeString()),M("Subscribe ",t),n===l.c&&(f.displayMode=2,b=n,y=t,p||r.a.disable(".shareScreenBtn"),r.a.disable([".displayModeBtn",".disableRemoteBtn"])),n!==b&&(2===f.displayMode?h.setRemoteVideoStreamType(t,1):(y&&h.setRemoteVideoStreamType(y,1),y=t,b=n)),h.subscribe(t,function(e){M("Subscribe stream failed",e)})}),h.on("peer-leave",function(e){var t=e.uid;if(M("Peer has left: "+t),M((new Date).toLocaleTimeString()),t===l.c&&(f.displayMode=0,"video"===f.attendeeMode&&r.a.enable(".shareScreenBtn"),r.a.enable([".displayModeBtn",".disableRemoteBtn"]),_()),t===b){var n=2===f.displayMode?l.c:v.getId();B(b,n),y=A(b=n)}k(e.uid)}),h.on("stream-subscribed",function(e){var t=e.stream;M("Got stream-subscribed event"),M((new Date).toLocaleTimeString()),M("Subscribe remote stream successfully: "+t.getId()),x(t)}),h.on("stream-removed",function(e){var t=e.stream,n=t.getId();if(M("Stream removed: "+n),M((new Date).toLocaleTimeString()),n===l.c&&(f.displayMode=0,"video"===f.attendeeMode&&r.a.enable(".shareScreenBtn"),r.a.enable([".displayModeBtn",".disableRemoteBtn"]),_()),n===b){var i=2===f.displayMode?l.c:v.getId();B(b,i),y=A(b=i)}k(t.getId())}),S(h,f).then(function(e){var t=Object(c.d)()?{}:{cameraId:f.cameraId,microphoneId:f.microphoneId};v=R(e,f,t),"audience"!==f.attendeeMode&&(b=e,y=v),h.enableDualStream(function(){M("Enable dual stream success!")},function(e){M(e)}),v.init(function(){"audience"!==f.attendeeMode&&(x(v,!0),h.publish(v,function(e){M("Publish local stream error: "+e)}))},function(e){M("getUserMedia failed",e)})})}.call(this,n(18))},function(e,t,n){}]);